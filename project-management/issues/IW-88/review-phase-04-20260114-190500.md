# Code Review Results

**Review Context:** Phase 4: Search by title - Linear for issue IW-88 (Iteration 1/3)
**Files Reviewed:** 3 files
**Skills Applied:** 4 (architecture, scala3, testing, composition)
**Timestamp:** 2026-01-14 19:05:00
**Git Context:** git diff c261fe1

---

<review skill="architecture">

## Architecture Review

### Critical Issues

None found. (Pre-existing architectural patterns noted as warnings/suggestions.)

### Warnings

#### Mixed Architectural Organization Pattern
**Location:** `.iw/core/LinearClient.scala`, `.iw/core/GitHubClient.scala`, `.iw/core/CaskServer.scala`
**Problem:** External API clients (LinearClient, GitHubClient) are in flat `core/` directory instead of `infrastructure/`. CaskServer correctly uses `iw.core.infrastructure` package.
**Impact:** Creates confusion about architectural boundaries.
**Recommendation:** Either move clients to infrastructure layer or acknowledge pragmatic flat structure as project-specific pattern. This is pre-existing tech debt from prior phases.

### Suggestions

#### LinearClient Functions Follow Good Separation Pattern
**Location:** `.iw/core/LinearClient.scala:96-98, 238-281, 367-393`
**Observation:** Pure functions (`buildSearchIssuesQuery`, `parseSearchIssuesResponse`) correctly separated from I/O functions (`searchIssues`). This enables testing without HTTP mocking.

#### Consider Extracting HTTP Backend Pattern
**Location:** `.iw/core/LinearClient.scala:367-393`
**Problem:** HTTP client pattern duplicated across multiple methods.
**Recommendation:** Consider extracting common `executeGraphQL` helper for future phases.

</review>

---

<review skill="scala3">

## Scala 3 Idioms Review

### Critical Issues

None found.

### Warnings

None found.

### Suggestions

#### Consider Opaque Type for CreatedIssue.id
**Location:** `.iw/core/LinearClient.scala:9`
**Problem:** Uses raw `String` for Linear's internal UUID, inconsistent with `IssueId` opaque type pattern.
**Impact:** Minor - only used internally in API responses.
**Recommendation:** Low priority since ID is only used for response, not passed around extensively.

</review>

---

<review skill="testing">

## Testing Review

### Critical Issues

None found.

### Warnings

#### Tests Examine String Content Instead of Behavior
**Location:** `.iw/core/test/LinearClientMockTest.scala:344-358`
**Problem:** Tests for `buildSearchIssuesQuery` verify string contents with multiple assertions checking for substrings rather than parsing JSON structure.
**Impact:** Tests are brittle - may break if format changes even if behavior is correct.
**Recommendation:** Consider parsing JSON and validating structure, or test through `searchIssues` directly.

#### Multiple Assertions Testing Same Error Path
**Location:** `.iw/core/test/LinearClientMockTest.scala:430-432, 479, 491`
**Problem:** Error assertions use broad `||` conditions that accept multiple error messages.
**Recommendation:** Use precise assertions matching exact error messages.

#### Test Names Don't Clearly Describe Behavior
**Location:** `.iw/core/test/LinearClientMockTest.scala:436, 469, 481`
**Problem:** Test names like "searchIssues success case (mocked backend)" describe test mechanics rather than expected behavior.
**Recommendation:** Use behavior-focused names like "searchIssues returns list of matching issues for valid query".

### Suggestions

- Consider extracting test data builders for JSON response construction
- Pure parsing functions could be in a separate test suite from HTTP tests
- Add edge case tests for special characters, empty queries, boundary limits

</review>

---

<review skill="composition">

## Composition Patterns Review

### Critical Issues

None found.

### Warnings

None found.

### Suggestions

#### Consider Extracting Common HTTP Request Pattern
**Location:** `.iw/core/LinearClient.scala:367-393`
**Problem:** Same HTTP request pattern repeated across `fetchIssue`, `createIssue`, `listRecentIssues`, `searchIssues`.
**Recommendation:** Extract common `executeGraphQLRequest` helper to reduce ~30 lines per method to ~3 lines.

#### Duplicate Parsing Logic Could Be Composed
**Location:** `.iw/core/LinearClient.scala:238-281`
**Problem:** `parseSearchIssuesResponse` duplicates parsing logic from `parseListRecentIssuesResponse`.
**Recommendation:** Extract common `parseIssueNode` helper.

</review>

---

## Summary

- **Critical issues:** 0 (must fix before merge)
- **Warnings:** 4 (should note for future)
- **Suggestions:** 7 (nice to have)

### By Skill
- architecture: 0 critical, 1 warning, 2 suggestions
- scala3: 0 critical, 0 warnings, 1 suggestion
- testing: 0 critical, 3 warnings, 3 suggestions
- composition: 0 critical, 0 warnings, 2 suggestions

### Assessment

Phase 4 implementation follows established patterns from Phases 1-3. No new critical issues introduced. The new code is consistent with existing codebase patterns. Existing patterns (HTTP duplication, flat structure) are tech debt items to address in future refactoring.

**Recommendation:** Proceed to merge. Note warnings for future phases.
