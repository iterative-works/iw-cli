# Code Review Results

**Review Context:** Phase 3: Recent issues - Linear for issue IW-88 (Iteration 1/3)
**Files Reviewed:** 3 files
**Skills Applied:** 4 (architecture, scala3, testing, composition)
**Timestamp:** 2026-01-14 18:45:00
**Git Context:** git diff 6a39036

---

<review skill="architecture">

## Architecture Review

### Critical Issues

None found.

### Warnings

#### Mixed Architectural Organization Pattern
**Location:** `.iw/core/LinearClient.scala`, `.iw/core/GitHubClient.scala`, `.iw/core/CaskServer.scala`
**Problem:** External API clients (LinearClient, GitHubClient) and web server (CaskServer) are in the flat `core/` directory alongside domain models. The project has `domain/` and `infrastructure/` subdirectories but they're nearly empty.
**Impact:** Creates confusion about architectural boundaries.
**Recommendation:** Either move clients to infrastructure layer or acknowledge pragmatic flat structure as project-specific pattern. This is pre-existing tech debt from prior phases.

### Suggestions

#### LinearClient Functions Follow Good Separation Pattern
**Location:** `.iw/core/LinearClient.scala:90-94, 183-230, 272-306`
**Observation:** Pure functions (`buildListRecentIssuesQuery`, `parseListRecentIssuesResponse`) are correctly separated from I/O functions (`listRecentIssues`). This enables testing without HTTP mocking.

#### Consider Extracting HTTP Backend Pattern
**Location:** `.iw/core/LinearClient.scala:280-306` and similar
**Problem:** HTTP client pattern duplicated across multiple methods.
**Recommendation:** Consider extracting common `executeGraphQL` helper for future phases.

</review>

---

<review skill="scala3">

## Scala 3 Idioms Review

### Critical Issues

None found.

### Warnings

None found.

### Suggestions

#### Consider Opaque Type for CreatedIssue.id
**Location:** `.iw/core/LinearClient.scala:9`
**Problem:** Uses raw `String` for Linear's internal UUID, inconsistent with `IssueId` opaque type pattern.
**Impact:** Minor - only used internally in API responses.
**Recommendation:** Low priority since ID is only used for response, not passed around extensively.

</review>

---

<review skill="testing">

## Testing Review

### Critical Issues

None found.

### Warnings

#### Testing Mocked Behavior Instead of Real Logic
**Location:** `.iw/core/test/LinearClientMockTest.scala:283-340`
**Problem:** Tests for `listRecentIssues` test mocked HTTP backend behavior rather than business logic.
**Impact:** Tests verify sttp SyncBackendStub works, not LinearClient's logic.
**Recommendation:** Consider moving HTTP tests to integration test suite; keep pure function tests (lines 183-279).

#### Missing Test Coverage for Parse Error Paths
**Location:** `.iw/core/test/LinearClientMockTest.scala:259-279`
**Problem:** Only one negative case tested (missing state field), but parser has multiple failure points.
**Recommendation:** Add tests for missing data/team/issues/nodes fields.

#### Inconsistent Assertion Style
**Location:** `.iw/core/test/LinearClientMockTest.scala:279, 328, 340`
**Problem:** Error assertions use broad `||` conditions.
**Recommendation:** Use precise assertions matching exact error messages.

### Suggestions

- Consider testing query structure more rigorously with JSON parsing
- Add boundary value tests for limit parameter (0, 1, 100)
- Test suite organization could be improved with clearer sections

</review>

---

<review skill="composition">

## Composition Patterns Review

### Critical Issues

None found.

### Warnings

#### Duplicated HTTP Request Pattern Not Composed
**Location:** `.iw/core/LinearClient.scala:44-65, 242-270, 280-306`
**Problem:** Three functions (`fetchIssue`, `createIssue`, `listRecentIssues`) contain duplicated HTTP request logic.
**Impact:** Violates DRY - changes must be made in three places.
**Recommendation:** Extract common `executeGraphQL` helper function.

#### Parsing Logic Could Use More Composition
**Location:** `.iw/core/LinearClient.scala:183-230`
**Problem:** Deeply nested field validation with repetitive pattern.
**Recommendation:** Consider extracting field extraction into composable helpers as complexity grows.

### Suggestions

#### Lambda in CaskServer Could Be Named Function
**Location:** `.iw/core/CaskServer.scala:536-555`
**Recommendation:** As more tracker types are added, consider extracting to named methods.

#### Test Organization Shows Good Composition (Positive)
**Observation:** Tests follow excellent composition principles - small, focused, well-organized.

</review>

---

## Summary

- **Critical issues:** 0 (must fix before merge)
- **Warnings:** 6 (should note for future)
- **Suggestions:** 8 (nice to have)

### By Skill
- architecture: 0 critical, 1 warning, 2 suggestions
- scala3: 0 critical, 0 warnings, 1 suggestion
- testing: 0 critical, 3 warnings, 3 suggestions
- composition: 0 critical, 2 warnings, 2 suggestions

### Assessment

Phase 3 implementation follows established patterns from Phases 1-2. No new critical issues introduced. Existing patterns (HTTP duplication, flat structure) are tech debt items to address in future refactoring.

**Recommendation:** Proceed to merge. Note warnings for future phases.
