# Code Review Results

**Review Context:** Phase 1: Project command discovery for issue IWLE-74 (Iteration 1/3)
**Files Reviewed:** 2 files
**Skills Applied:** 2 (style, testing)
**Timestamp:** 2025-12-18 14:33:01
**Git Context:** git diff IWLE-74...HEAD

---

<review skill="style">

## Code Style Review

### Critical Issues

None found.

### Warnings

#### Missing PURPOSE Comments in Shell Script
**Location:** `iw-run:77-117` (new code block)
**Problem:** The newly added shell function block for listing project commands lacks inline comments explaining the logic, particularly around the two-pass approach and hook file filtering
**Impact:** While the file has a PURPOSE header, complex logic blocks should have explanatory comments for maintainability
**Recommendation:** Add comments explaining WHY the code does a two-pass check (first to see if commands exist, then to list them) and WHY hook files are excluded

#### Inconsistent Variable Naming Convention in Test File
**Location:** `.iw/test/project-commands-list.bats:7-28`
**Problem:** Shell variables use inconsistent casing - some are uppercase (TEST_DIR, IW_COMMANDS_DIR) while others would typically be lowercase in shell scripts
**Impact:** Minor style inconsistency, though TEST_DIR being uppercase is actually correct for exported variables
**Recommendation:** This is acceptable as-is since exported environment variables conventionally use UPPERCASE. No change needed, but documenting for awareness.

### Suggestions

#### Test File Organization
**Location:** `.iw/test/project-commands-list.bats:48-112`
**Problem:** Test cases could benefit from more descriptive comments explaining what scenario each test covers and why it matters

#### Test File PURPOSE Comments Could Be More Specific
**Location:** `.iw/test/project-commands-list.bats:2-3`
**Problem:** The second PURPOSE line is somewhat generic

#### Shell Script Comments Could Explain Business Logic
**Location:** `iw-run:77-117`
**Problem:** The code shows WHAT is being done (check for commands, filter hooks) but not WHY from a user perspective

</review>

---

<review skill="testing">

## Testing Review

### Critical Issues

#### Missing Test Coverage for Edge Cases in parse_command_header
**Location:** `iw-run:78-119` (project commands section)
**Problem:** The new code calls `parse_command_header` to extract PURPOSE and USAGE from project command files, but there are no tests verifying what happens when these headers are malformed, missing, or contain special characters that could break the shell parsing.
**Impact:** The implementation could fail silently or produce incorrect output if project command files have malformed headers.
**Recommendation:** Add E2E test cases covering missing headers, multiline headers, and special characters.

#### No Test for Hook File Exclusion in Project Commands
**Location:** `.iw/test/project-commands-list.bats:80-95`
**Problem:** The implementation explicitly skips hook files (*.hook-*.scala) when listing project commands, but there's no test verifying this behavior.
**Impact:** Without a test, future refactoring could break hook file filtering, causing hook files to appear in the command list.
**Recommendation:** Add test case for hook file exclusion.

### Warnings

#### Test Setup Creates Unnecessary Git Repository
**Location:** `.iw/test/project-commands-list.bats:10-13`
**Problem:** The test setup initializes a git repository, but the tests don't exercise any git functionality. This is unnecessary setup that slows down tests.
**Recommendation:** Remove git initialization unless needed.

#### Tests Don't Verify Boundary Between Shared and Project Commands
**Location:** `.iw/test/project-commands-list.bats:48-62`
**Problem:** While tests verify that the "Project commands" section appears, they don't verify that shared commands still appear correctly or that the two sections are properly separated.
**Recommendation:** Add assertion to verify shared commands are still listed.

#### Test Hardcodes Command Structure Instead of Testing Behavior
**Location:** `.iw/test/project-commands-list.bats:97-112`
**Problem:** The test creates a complete Scala command file just to test PURPOSE parsing, which couples the test to implementation details.

### Suggestions

#### Consider Extracting Test Data Setup Helper
**Location:** `.iw/test/project-commands-list.bats:49-57, 66-73, 99-106`
**Problem:** Each test manually creates command files with similar structure, creating duplication.

#### Test Naming Could Be More Behavior-Focused
**Location:** `.iw/test/project-commands-list.bats:48, 64, 80, 88, 97`
**Problem:** Test names are verbose and somewhat redundant.

#### Add Test for USAGE Metadata Display
**Location:** `.iw/test/project-commands-list.bats` (missing)
**Problem:** Test verifies PURPOSE metadata but there's no explicit test for USAGE metadata display.

</review>

---

## Summary

- **Critical issues:** 2 (must fix before merge)
- **Warnings:** 5 (should fix)
- **Suggestions:** 6 (nice to have)

### By Skill
- style: 0 critical, 2 warnings, 3 suggestions
- testing: 2 critical, 3 warnings, 3 suggestions
