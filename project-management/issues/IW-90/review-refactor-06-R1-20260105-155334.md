# Code Review Results

**Review Context:** Refactoring R1: Align GitLab IDs with TEAM-NNN format for issue IW-90 (Iteration 2/3)
**Files Reviewed:** 14 files
**Skills Applied:** 2 (scala3, testing)
**Timestamp:** 2026-01-05 15:53:34
**Git Context:** git diff a67c23b

---

<review skill="scala3">

## Scala 3 Idioms Review

### Critical Issues

None found.

### Warnings

#### Fragile String Parsing with split("-").last
**Location:** `.iw/core/GitHubClient.scala:284`, `.iw/core/GitLabClient.scala:203`
**Problem:** Using `split("-").last` assumes the issue ID format will always contain a hyphen and could throw on malformed input
**Impact:** Runtime exception risk if issue ID doesn't contain a hyphen. Although IssueId is an opaque type with validation, the extraction logic doesn't leverage pattern matching for safety.
**Recommendation:** Consider adding a `number` extension method to IssueId opaque type for type-safe extraction.

#### Match Expression Could Use Inline Pattern
**Location:** Multiple locations (`.iw/commands/issue.scala:50-53`, `.iw/commands/start.scala:26-29`, etc.)
**Problem:** Repeated pattern of matching IssueTrackerType for team prefix extraction
**Impact:** Code duplication across multiple command files
**Recommendation:** Extract to a helper method on ProjectConfiguration

### Suggestions

- Consider adding helper methods to IssueTrackerType enum (usesTeamPrefix, requiresRepository)
- Pattern matching on opaque type could use smart destructuring with unapply
- IssueId parse could benefit from typed errors if programmatic error handling needed

</review>

---

<review skill="testing">

## Testing Review

### Critical Issues

None found.

### Warnings

#### Tests Use Reasonable Test Doubles, Not Problematic Mocks
**Location:** `.iw/core/test/GitHubClientTest.scala`, `.iw/core/test/GitLabClientTest.scala`
**Problem:** Variable names use "mock" prefix but these are actually proper test doubles (function implementations)
**Impact:** Minor naming confusion
**Recommendation:** Consider renaming from `mockX` to `testX` or `stubX`

#### E2E Test Coverage Gap for TEAM-NNN Format Validation
**Location:** `.iw/test/gitlab-issue.bats`
**Problem:** Tests verify output contains `PROJ-123` but don't have explicit assertions about exact format
**Impact:** Low - unit tests cover this comprehensively
**Recommendation:** Consider adding explicit format validation test

### Suggestions

- Extract common test setup for client tests
- Add edge case test for empty team prefix
- Consider parameterized tests for format variations

</review>

---

## Summary

- **Critical issues:** 0 (none - ready to proceed)
- **Warnings:** 4 (should consider fixing)
- **Suggestions:** 6 (nice to have)

### By Skill
- scala3: 0 critical, 2 warnings, 3 suggestions
- testing: 0 critical, 2 warnings, 3 suggestions

### Previous Iteration Issues - RESOLVED

The critical issues from Iteration 1 have been fixed:
1. ✅ GitLabClient now uses full TEAM-NNN format for Issue.id
2. ✅ GitHubClient now uses full TEAM-NNN format for Issue.id
3. ✅ Unit tests updated to verify correct format
4. ✅ E2E tests pass (13/13 GitLab tests)
